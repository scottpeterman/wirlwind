<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Network Device Operations Console</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=JetBrains+Mono:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-primary: #0a0e14;
    --bg-panel: #111820;
    --bg-panel-header: #151d27;
    --border: #1e2a38;
    --border-accent: #2a3a4e;
    --text-primary: #c8d6e5;
    --text-secondary: #6b7d93;
    --text-dim: #3d4f63;
    --green: #00e676;
    --green-dim: #00e67633;
    --amber: #ffab00;
    --amber-dim: #ffab0033;
    --red: #ff1744;
    --red-dim: #ff174433;
    --cyan: #00e5ff;
    --cyan-dim: #00e5ff22;
    --blue: #2979ff;
    --blue-dim: #2979ff33;
    --purple: #d500f9;
    --scanline: rgba(0, 229, 255, 0.03);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    overflow-x: hidden;
    min-height: 100vh;
  }

  /* Scanline overlay */
  body::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      var(--scanline) 2px,
      var(--scanline) 4px
    );
    pointer-events: none;
    z-index: 9999;
  }

  /* Top header bar */
  .header {
    background: linear-gradient(180deg, #0f1822 0%, var(--bg-primary) 100%);
    border-bottom: 1px solid var(--border);
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: relative;
  }

  .header::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--cyan), transparent);
    opacity: 0.4;
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .logo-mark {
    width: 36px; height: 36px;
    border: 2px solid var(--cyan);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Orbitron', monospace;
    font-weight: 900;
    font-size: 14px;
    color: var(--cyan);
    background: var(--cyan-dim);
    text-shadow: 0 0 10px var(--cyan);
    box-shadow: 0 0 15px var(--cyan-dim);
  }

  .device-identity h1 {
    font-family: 'Orbitron', monospace;
    font-size: 15px;
    font-weight: 700;
    color: var(--text-primary);
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .device-identity .subtitle {
    font-size: 10px;
    color: var(--text-secondary);
    letter-spacing: 1px;
    margin-top: 2px;
  }

  .header-meta {
    display: flex;
    gap: 24px;
    align-items: center;
  }

  .meta-item {
    text-align: right;
  }

  .meta-label {
    font-size: 9px;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 1.5px;
  }

  .meta-value {
    font-size: 12px;
    color: var(--text-secondary);
    font-weight: 500;
  }

  .meta-value.status-up {
    color: var(--green);
    text-shadow: 0 0 8px var(--green-dim);
  }

  .status-dot {
    display: inline-block;
    width: 6px; height: 6px;
    background: var(--green);
    border-radius: 50%;
    margin-right: 4px;
    box-shadow: 0 0 6px var(--green);
    animation: pulse-dot 2s ease-in-out infinite;
  }

  @keyframes pulse-dot {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  /* Info strip */
  .info-strip {
    background: var(--bg-panel);
    border-bottom: 1px solid var(--border);
    padding: 8px 20px;
    display: flex;
    gap: 32px;
    font-size: 11px;
    overflow-x: auto;
  }

  .info-chip {
    display: flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
  }

  .info-chip .label {
    color: var(--text-dim);
    text-transform: uppercase;
    font-size: 9px;
    letter-spacing: 1px;
  }

  .info-chip .value {
    color: var(--text-secondary);
    font-weight: 500;
  }

  /* Grid layout */
  .dashboard {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    grid-template-rows: auto;
    gap: 2px;
    padding: 2px;
    background: var(--bg-primary);
  }

  .panel {
    background: var(--bg-panel);
    border: 1px solid var(--border);
    overflow: hidden;
    position: relative;
  }

  .panel-header {
    background: var(--bg-panel-header);
    padding: 8px 14px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
    position: relative;
  }

  .panel-header::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 3px;
  }

  .panel-header.green::before { background: var(--green); box-shadow: 0 0 8px var(--green-dim); }
  .panel-header.amber::before { background: var(--amber); box-shadow: 0 0 8px var(--amber-dim); }
  .panel-header.cyan::before { background: var(--cyan); box-shadow: 0 0 8px var(--cyan-dim); }
  .panel-header.blue::before { background: var(--blue); box-shadow: 0 0 8px var(--blue-dim); }
  .panel-header.red::before { background: var(--red); box-shadow: 0 0 8px var(--red-dim); }
  .panel-header.purple::before { background: var(--purple); }

  .panel-title {
    font-family: 'Orbitron', monospace;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-secondary);
  }

  .panel-badge {
    font-size: 9px;
    padding: 2px 8px;
    border-radius: 2px;
    font-weight: 600;
    letter-spacing: 1px;
  }

  .badge-ok { background: var(--green-dim); color: var(--green); border: 1px solid #00e67644; }
  .badge-warn { background: var(--amber-dim); color: var(--amber); border: 1px solid #ffab0044; }
  .badge-crit { background: var(--red-dim); color: var(--red); border: 1px solid #ff174444; }

  .panel-body {
    padding: 12px;
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .chart-container {
    width: 100%;
    height: 100%;
    min-height: 200px;
  }

  /* Span classes */
  .span-2 { grid-column: span 2; }
  .span-3 { grid-column: span 3; }
  .tall { min-height: 320px; }
  .tall .panel-body { min-height: 290px; }

  /* Table styles */
  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
  }

  .data-table th {
    text-align: left;
    padding: 6px 10px;
    color: var(--text-dim);
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-weight: 600;
    border-bottom: 1px solid var(--border);
    background: var(--bg-panel-header);
    position: sticky;
    top: 0;
  }

  .data-table td {
    padding: 5px 10px;
    border-bottom: 1px solid #111820;
    color: var(--text-secondary);
    font-family: 'Share Tech Mono', monospace;
  }

  .data-table tr:hover td {
    background: #0d1520;
  }

  .intf-up { color: var(--green); }
  .intf-down { color: var(--red); }
  .intf-admin-down { color: var(--text-dim); }

  .util-bar {
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
    min-width: 60px;
  }

  .util-bar-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 0.5s ease;
  }

  .util-low { background: var(--green); box-shadow: 0 0 4px var(--green-dim); }
  .util-med { background: var(--amber); box-shadow: 0 0 4px var(--amber-dim); }
  .util-high { background: var(--red); box-shadow: 0 0 4px var(--red-dim); }

  .table-scroll {
    overflow-y: auto;
    max-height: 280px;
    width: 100%;
  }

  .table-scroll::-webkit-scrollbar { width: 4px; }
  .table-scroll::-webkit-scrollbar-track { background: var(--bg-panel); }
  .table-scroll::-webkit-scrollbar-thumb { background: var(--border-accent); border-radius: 2px; }

  /* Neighbor node styles */
  .neighbor-display {
    width: 100%;
    height: 100%;
    position: relative;
  }

  /* Live timestamp */
  .live-clock {
    font-family: 'Share Tech Mono', monospace;
    font-size: 11px;
    color: var(--cyan);
    text-shadow: 0 0 8px var(--cyan-dim);
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .dashboard {
      grid-template-columns: 1fr 1fr;
    }
    .span-3 { grid-column: span 2; }
  }

  @media (max-width: 768px) {
    .dashboard {
      grid-template-columns: 1fr;
    }
    .span-2, .span-3 { grid-column: span 1; }
    .header { flex-direction: column; gap: 10px; }
    .header-meta { flex-wrap: wrap; }
  }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="header-left">
    <div class="logo-mark">N0</div>
    <div class="device-identity">
      <h1>core-rtr-01.iad1</h1>
      <div class="subtitle">Cisco C8500-12X · IOS-XE 17.12.02 · Kentik PoP IAD1</div>
    </div>
  </div>
  <div class="header-meta">
    <div class="meta-item">
      <div class="meta-label">Status</div>
      <div class="meta-value status-up"><span class="status-dot"></span>REACHABLE</div>
    </div>
    <div class="meta-item">
      <div class="meta-label">Uptime</div>
      <div class="meta-value">347d 14h 22m</div>
    </div>
    <div class="meta-item">
      <div class="meta-label">Serial</div>
      <div class="meta-value">FXS2419Q3ZB</div>
    </div>
    <div class="meta-item">
      <div class="meta-label">Last Poll</div>
      <div class="meta-value live-clock" id="liveClock">--:--:--</div>
    </div>
  </div>
</div>

<!-- Info strip -->
<div class="info-strip">
  <div class="info-chip">
    <span class="label">Mgmt IP</span>
    <span class="value">10.100.1.1</span>
  </div>
  <div class="info-chip">
    <span class="label">Loopback0</span>
    <span class="value">172.16.255.1/32</span>
  </div>
  <div class="info-chip">
    <span class="label">AS</span>
    <span class="value">AS394256</span>
  </div>
  <div class="info-chip">
    <span class="label">BGP Peers</span>
    <span class="value" style="color:var(--green)">14 Est</span>
    <span class="value" style="color:var(--amber)">/ 2 Idle</span>
  </div>
  <div class="info-chip">
    <span class="label">SNMP</span>
    <span class="value">v3 · kentik-ro</span>
  </div>
  <div class="info-chip">
    <span class="label">Location</span>
    <span class="value">Equinix DC2 · Ashburn, VA · Rack C14-03</span>
  </div>
  <div class="info-chip">
    <span class="label">Chassis Temp</span>
    <span class="value" style="color:var(--green)">42°C</span>
  </div>
</div>

<!-- Dashboard Grid -->
<div class="dashboard">

  <!-- CPU Gauge -->
  <div class="panel">
    <div class="panel-header green">
      <span class="panel-title">CPU Utilization</span>
      <span class="panel-badge badge-ok">NORMAL</span>
    </div>
    <div class="panel-body">
      <div class="chart-container" id="cpuGauge"></div>
    </div>
  </div>

  <!-- Memory Gauge -->
  <div class="panel">
    <div class="panel-header amber">
      <span class="panel-title">Memory Utilization</span>
      <span class="panel-badge badge-warn">ELEVATED</span>
    </div>
    <div class="panel-body">
      <div class="chart-container" id="memGauge"></div>
    </div>
  </div>

  <!-- Environment / Temps -->
  <div class="panel">
    <div class="panel-header cyan">
      <span class="panel-title">Environment Sensors</span>
      <span class="panel-badge badge-ok">NOMINAL</span>
    </div>
    <div class="panel-body">
      <div class="chart-container" id="envChart"></div>
    </div>
  </div>

  <!-- Interface Throughput - spans 2 -->
  <div class="panel span-2 tall">
    <div class="panel-header blue">
      <span class="panel-title">Interface Throughput · Last 6 Hours</span>
      <span class="panel-badge badge-ok">HEALTHY</span>
    </div>
    <div class="panel-body">
      <div class="chart-container" id="throughputChart"></div>
    </div>
  </div>

  <!-- Top Processes -->
  <div class="panel tall">
    <div class="panel-header green">
      <span class="panel-title">Top Processes · CPU</span>
    </div>
    <div class="panel-body" style="align-items:flex-start;padding:0;">
      <div class="table-scroll" style="max-height:290px;">
        <table class="data-table" id="processTable">
          <thead>
            <tr><th>PID</th><th>Name</th><th>CPU%</th><th>MEM</th><th>Runtime</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- CPU / Memory History - spans 2 -->
  <div class="panel span-2 tall">
    <div class="panel-header purple">
      <span class="panel-title">CPU &amp; Memory · 24 Hour Trend</span>
    </div>
    <div class="panel-body">
      <div class="chart-container" id="historyChart"></div>
    </div>
  </div>

  <!-- LLDP Neighbors -->
  <div class="panel tall">
    <div class="panel-header cyan">
      <span class="panel-title">LLDP / CDP Neighbors</span>
    </div>
    <div class="panel-body">
      <div class="chart-container" id="neighborGraph"></div>
    </div>
  </div>

  <!-- Interface Table - spans 3 -->
  <div class="panel span-3">
    <div class="panel-header blue">
      <span class="panel-title">Interface Status · Operational</span>
      <span class="panel-badge badge-ok">12 UP / 2 DOWN / 1 ADMIN-DOWN</span>
    </div>
    <div class="panel-body" style="align-items:flex-start;padding:0;">
      <div class="table-scroll" style="max-height:260px;width:100%;">
        <table class="data-table" id="intfTable">
          <thead>
            <tr>
              <th>Interface</th><th>Status</th><th>Protocol</th><th>IP Address</th>
              <th>Speed</th><th>MTU</th><th>In (Mbps)</th><th>Out (Mbps)</th>
              <th>Utilization</th><th>Errors In</th><th>Errors Out</th><th>Description</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- BGP Peers Summary - spans 2 -->
  <div class="panel span-2">
    <div class="panel-header green">
      <span class="panel-title">BGP Peer Summary</span>
    </div>
    <div class="panel-body" style="align-items:flex-start;padding:0;">
      <div class="table-scroll" style="max-height:240px;width:100%;">
        <table class="data-table" id="bgpTable">
          <thead>
            <tr>
              <th>Neighbor</th><th>Remote AS</th><th>State</th><th>Up/Down</th>
              <th>Prefixes Rcvd</th><th>Prefixes Sent</th><th>Description</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Per-Interface Error Rate -->
  <div class="panel">
    <div class="panel-header red">
      <span class="panel-title">Interface Errors · 1hr</span>
      <span class="panel-badge badge-ok">LOW</span>
    </div>
    <div class="panel-body">
      <div class="chart-container" id="errorChart"></div>
    </div>
  </div>

</div>

<script>
// ===== SIMULATED DEVICE DATA =====
// In production you'd pull this from SNMP, gNMI, Netconf, or REST API

const DEVICE = {
  hostname: 'core-rtr-01.iad1',
  cpu: 34,
  memory: { used: 12582912, total: 16777216 }, // KB
  memPct: 75,
};

// Generate time series
function genTimeSeries(hours, interval, baseFn) {
  const now = Date.now();
  const pts = [];
  for (let i = hours * 60; i >= 0; i -= interval) {
    const t = new Date(now - i * 60000);
    pts.push({ time: t, value: baseFn(i) });
  }
  return pts;
}

function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }

// ===== LIVE CLOCK =====
function updateClock() {
  const now = new Date();
  document.getElementById('liveClock').textContent =
    now.toLocaleTimeString('en-US', { hour12: false }) + ' UTC';
}
setInterval(updateClock, 1000);
updateClock();

// ===== CPU GAUGE =====
const cpuChart = echarts.init(document.getElementById('cpuGauge'), null, { renderer: 'canvas' });
cpuChart.setOption({
  series: [{
    type: 'gauge',
    startAngle: 220,
    endAngle: -40,
    min: 0,
    max: 100,
    splitNumber: 10,
    radius: '90%',
    axisLine: {
      lineStyle: {
        width: 12,
        color: [
          [0.6, '#00e676'],
          [0.8, '#ffab00'],
          [1, '#ff1744']
        ]
      }
    },
    pointer: {
      itemStyle: { color: '#c8d6e5' },
      width: 4,
      length: '60%'
    },
    axisTick: { distance: -12, length: 6, lineStyle: { color: '#1e2a38', width: 1 } },
    splitLine: { distance: -14, length: 12, lineStyle: { color: '#2a3a4e', width: 1 } },
    axisLabel: { color: '#3d4f63', distance: 20, fontSize: 10, fontFamily: 'Share Tech Mono' },
    detail: {
      valueAnimation: true,
      formatter: '{value}%',
      color: '#c8d6e5',
      fontSize: 28,
      fontFamily: 'Orbitron',
      fontWeight: 700,
      offsetCenter: [0, '70%']
    },
    title: {
      offsetCenter: [0, '92%'],
      fontSize: 10,
      color: '#3d4f63',
      fontFamily: 'JetBrains Mono'
    },
    data: [{ value: DEVICE.cpu, name: '5-MIN AVG' }]
  }]
});

// ===== MEMORY GAUGE =====
const memChart = echarts.init(document.getElementById('memGauge'), null, { renderer: 'canvas' });
memChart.setOption({
  series: [{
    type: 'gauge',
    startAngle: 220,
    endAngle: -40,
    min: 0,
    max: 100,
    splitNumber: 10,
    radius: '90%',
    axisLine: {
      lineStyle: {
        width: 12,
        color: [
          [0.5, '#00e676'],
          [0.75, '#ffab00'],
          [1, '#ff1744']
        ]
      }
    },
    pointer: {
      itemStyle: { color: '#c8d6e5' },
      width: 4,
      length: '60%'
    },
    axisTick: { distance: -12, length: 6, lineStyle: { color: '#1e2a38', width: 1 } },
    splitLine: { distance: -14, length: 12, lineStyle: { color: '#2a3a4e', width: 1 } },
    axisLabel: { color: '#3d4f63', distance: 20, fontSize: 10, fontFamily: 'Share Tech Mono' },
    detail: {
      valueAnimation: true,
      formatter: '{value}%',
      color: '#ffab00',
      fontSize: 28,
      fontFamily: 'Orbitron',
      fontWeight: 700,
      offsetCenter: [0, '70%'],
      textShadowColor: '#ffab0044',
      textShadowBlur: 10
    },
    title: {
      offsetCenter: [0, '92%'],
      fontSize: 10,
      color: '#3d4f63',
      fontFamily: 'JetBrains Mono'
    },
    data: [{ value: DEVICE.memPct, name: '12.0 / 16.0 GB' }]
  }]
});

// ===== ENVIRONMENT SENSORS =====
const envChart = echarts.init(document.getElementById('envChart'), null, { renderer: 'canvas' });
envChart.setOption({
  grid: { left: 90, right: 30, top: 10, bottom: 10 },
  xAxis: {
    type: 'value',
    max: 100,
    axisLine: { lineStyle: { color: '#1e2a38' } },
    axisLabel: { color: '#3d4f63', fontFamily: 'Share Tech Mono', fontSize: 10 },
    splitLine: { lineStyle: { color: '#111820' } }
  },
  yAxis: {
    type: 'category',
    data: ['PSU-1', 'PSU-2', 'Fan Tray 1', 'Fan Tray 2', 'Inlet', 'Outlet', 'CPU Die'],
    axisLine: { lineStyle: { color: '#1e2a38' } },
    axisLabel: { color: '#6b7d93', fontFamily: 'Share Tech Mono', fontSize: 10 }
  },
  series: [{
    type: 'bar',
    data: [
      { value: 38, itemStyle: { color: '#00e676' } },
      { value: 36, itemStyle: { color: '#00e676' } },
      { value: 4200, itemStyle: { color: '#00e5ff' }, label: { show: true, position: 'right', formatter: '4200 RPM', color: '#6b7d93', fontSize: 9, fontFamily: 'Share Tech Mono' } },
      { value: 4100, itemStyle: { color: '#00e5ff' }, label: { show: true, position: 'right', formatter: '4100 RPM', color: '#6b7d93', fontSize: 9, fontFamily: 'Share Tech Mono' } },
      { value: 24, itemStyle: { color: '#00e676' } },
      { value: 42, itemStyle: { color: '#00e676' } },
      { value: 58, itemStyle: { color: '#ffab00' } }
    ],
    barWidth: 10,
    label: {
      show: true,
      position: 'right',
      formatter: (p) => {
        if (p.dataIndex <= 1 || p.dataIndex >= 4) return p.value + '°C';
        return '';
      },
      color: '#6b7d93',
      fontSize: 9,
      fontFamily: 'Share Tech Mono'
    }
  }]
});

// ===== INTERFACE THROUGHPUT =====
const throughputChart = echarts.init(document.getElementById('throughputChart'), null, { renderer: 'canvas' });
const hours6 = 360;
const tpIn = genTimeSeries(6, 5, (i) => clamp(2400 + Math.sin(i/40)*800 + Math.random()*400 - 200 + (i < 120 ? 600 : 0), 800, 4200));
const tpOut = genTimeSeries(6, 5, (i) => clamp(1800 + Math.cos(i/35)*600 + Math.random()*300 - 150 + (i < 120 ? 400 : 0), 500, 3200));

throughputChart.setOption({
  tooltip: {
    trigger: 'axis',
    backgroundColor: '#151d27',
    borderColor: '#2a3a4e',
    textStyle: { color: '#c8d6e5', fontFamily: 'Share Tech Mono', fontSize: 11 },
    formatter: (params) => {
      const t = params[0].axisValueLabel;
      return `${t}<br/>${params.map(p => `${p.marker} ${p.seriesName}: <b>${p.value} Mbps</b>`).join('<br/>')}`;
    }
  },
  legend: {
    data: ['Inbound (Aggregate)', 'Outbound (Aggregate)'],
    textStyle: { color: '#6b7d93', fontFamily: 'Share Tech Mono', fontSize: 10 },
    top: 5, right: 10
  },
  grid: { left: 60, right: 20, top: 40, bottom: 30 },
  xAxis: {
    type: 'category',
    data: tpIn.map(p => p.time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false })),
    axisLine: { lineStyle: { color: '#1e2a38' } },
    axisLabel: { color: '#3d4f63', fontFamily: 'Share Tech Mono', fontSize: 9, interval: 11 },
    splitLine: { show: false }
  },
  yAxis: {
    type: 'value',
    name: 'Mbps',
    nameTextStyle: { color: '#3d4f63', fontFamily: 'Share Tech Mono', fontSize: 9 },
    axisLine: { lineStyle: { color: '#1e2a38' } },
    axisLabel: { color: '#3d4f63', fontFamily: 'Share Tech Mono', fontSize: 10 },
    splitLine: { lineStyle: { color: '#111820' } }
  },
  series: [
    {
      name: 'Inbound (Aggregate)',
      type: 'line',
      data: tpIn.map(p => Math.round(p.value)),
      smooth: true,
      showSymbol: false,
      lineStyle: { color: '#00e5ff', width: 2 },
      areaStyle: {
        color: {
          type: 'linear', x: 0, y: 0, x2: 0, y2: 1,
          colorStops: [
            { offset: 0, color: 'rgba(0,229,255,0.25)' },
            { offset: 1, color: 'rgba(0,229,255,0)' }
          ]
        }
      }
    },
    {
      name: 'Outbound (Aggregate)',
      type: 'line',
      data: tpOut.map(p => Math.round(p.value)),
      smooth: true,
      showSymbol: false,
      lineStyle: { color: '#d500f9', width: 2 },
      areaStyle: {
        color: {
          type: 'linear', x: 0, y: 0, x2: 0, y2: 1,
          colorStops: [
            { offset: 0, color: 'rgba(213,0,249,0.2)' },
            { offset: 1, color: 'rgba(213,0,249,0)' }
          ]
        }
      }
    }
  ]
});

// ===== PROCESS TABLE =====
const processes = [
  { pid: 1, name: 'Chunk Manager', cpu: 8.2, mem: '384M', runtime: '347d 14h' },
  { pid: 45, name: 'BGP Router', cpu: 5.7, mem: '1.2G', runtime: '347d 14h' },
  { pid: 12, name: 'CEF Process', cpu: 4.1, mem: '892M', runtime: '347d 14h' },
  { pid: 78, name: 'SNMP Engine', cpu: 3.4, mem: '128M', runtime: '347d 14h' },
  { pid: 23, name: 'IP Input', cpu: 2.8, mem: '256M', runtime: '347d 14h' },
  { pid: 102, name: 'BGP Scanner', cpu: 2.1, mem: '96M', runtime: '347d 14h' },
  { pid: 56, name: 'LLDP Protocol', cpu: 1.2, mem: '48M', runtime: '347d 14h' },
  { pid: 89, name: 'SSH Process', cpu: 0.9, mem: '64M', runtime: '23h 41m' },
  { pid: 34, name: 'OSPF-1', cpu: 0.7, mem: '128M', runtime: '347d 14h' },
  { pid: 201, name: 'Crypto Engine', cpu: 0.5, mem: '96M', runtime: '347d 14h' },
  { pid: 67, name: 'ARP Input', cpu: 0.3, mem: '32M', runtime: '347d 14h' },
  { pid: 445, name: 'Syslog', cpu: 0.2, mem: '24M', runtime: '347d 14h' },
  { pid: 99, name: 'Net Topology', cpu: 0.1, mem: '48M', runtime: '215d 8h' },
  { pid: 312, name: 'NETCONF Agent', cpu: 0.1, mem: '72M', runtime: '347d 14h' },
];

const ptBody = document.querySelector('#processTable tbody');
processes.forEach(p => {
  const cpuColor = p.cpu > 5 ? 'var(--amber)' : p.cpu > 2 ? 'var(--text-secondary)' : 'var(--text-dim)';
  ptBody.innerHTML += `<tr>
    <td>${p.pid}</td>
    <td>${p.name}</td>
    <td style="color:${cpuColor};font-weight:600">${p.cpu}%</td>
    <td>${p.mem}</td>
    <td style="color:var(--text-dim)">${p.runtime}</td>
  </tr>`;
});

// ===== 24H CPU/MEMORY TREND =====
const histChart = echarts.init(document.getElementById('historyChart'), null, { renderer: 'canvas' });
const cpuHist = genTimeSeries(24, 15, (i) => clamp(28 + Math.sin(i/60)*12 + Math.random()*8, 10, 65));
const memHist = genTimeSeries(24, 15, (i) => clamp(72 + Math.sin(i/90)*5 + Math.random()*3 + (i < 200 ? -3 : 0), 60, 85));

histChart.setOption({
  tooltip: {
    trigger: 'axis',
    backgroundColor: '#151d27',
    borderColor: '#2a3a4e',
    textStyle: { color: '#c8d6e5', fontFamily: 'Share Tech Mono', fontSize: 11 }
  },
  legend: {
    data: ['CPU %', 'Memory %'],
    textStyle: { color: '#6b7d93', fontFamily: 'Share Tech Mono', fontSize: 10 },
    top: 5, right: 10
  },
  grid: { left: 50, right: 20, top: 40, bottom: 30 },
  xAxis: {
    type: 'category',
    data: cpuHist.map(p => p.time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false })),
    axisLine: { lineStyle: { color: '#1e2a38' } },
    axisLabel: { color: '#3d4f63', fontFamily: 'Share Tech Mono', fontSize: 9, interval: 11 },
    splitLine: { show: false }
  },
  yAxis: {
    type: 'value',
    min: 0, max: 100,
    name: '%',
    nameTextStyle: { color: '#3d4f63', fontFamily: 'Share Tech Mono', fontSize: 9 },
    axisLine: { lineStyle: { color: '#1e2a38' } },
    axisLabel: { color: '#3d4f63', fontFamily: 'Share Tech Mono', fontSize: 10 },
    splitLine: { lineStyle: { color: '#111820' } }
  },
  series: [
    {
      name: 'CPU %',
      type: 'line',
      data: cpuHist.map(p => Math.round(p.value)),
      smooth: true,
      showSymbol: false,
      lineStyle: { color: '#00e676', width: 1.5 },
      areaStyle: {
        color: { type: 'linear', x: 0, y: 0, x2: 0, y2: 1,
          colorStops: [{ offset: 0, color: 'rgba(0,230,118,0.15)' }, { offset: 1, color: 'rgba(0,230,118,0)' }]
        }
      }
    },
    {
      name: 'Memory %',
      type: 'line',
      data: memHist.map(p => Math.round(p.value)),
      smooth: true,
      showSymbol: false,
      lineStyle: { color: '#ffab00', width: 1.5 },
      areaStyle: {
        color: { type: 'linear', x: 0, y: 0, x2: 0, y2: 1,
          colorStops: [{ offset: 0, color: 'rgba(255,171,0,0.12)' }, { offset: 1, color: 'rgba(255,171,0,0)' }]
        }
      }
    }
  ]
});

// ===== NEIGHBOR GRAPH =====
const neighborChart = echarts.init(document.getElementById('neighborGraph'), null, { renderer: 'canvas' });
const neighbors = [
  { name: 'dist-sw-01\nNexus 9300', port: 'Te0/0/0' },
  { name: 'dist-sw-02\nNexus 9300', port: 'Te0/0/1' },
  { name: 'edge-rtr-01\nASR 1002-HX', port: 'Te0/0/2' },
  { name: 'edge-rtr-02\nASR 1002-HX', port: 'Te0/0/3' },
  { name: 'fw-01\nPalo PA-5260', port: 'Te0/0/4' },
  { name: 'core-rtr-02\nC8500-12X', port: 'Te0/0/5' },
  { name: 'oob-sw-01\nCat 9300', port: 'Gi0/0/0' },
];

neighborChart.setOption({
  tooltip: {
    formatter: (p) => {
      if (p.dataType === 'edge') return `${p.data.label || ''}`;
      return p.data.name.replace('\n', '<br/>');
    },
    backgroundColor: '#151d27',
    borderColor: '#2a3a4e',
    textStyle: { color: '#c8d6e5', fontFamily: 'Share Tech Mono', fontSize: 11 }
  },
  series: [{
    type: 'graph',
    layout: 'force',
    roam: true,
    force: { repulsion: 220, edgeLength: [80, 140], gravity: 0.15 },
    label: {
      show: true,
      color: '#c8d6e5',
      fontSize: 9,
      fontFamily: 'Share Tech Mono',
      formatter: (p) => p.data.name
    },
    edgeLabel: {
      show: true,
      fontSize: 8,
      fontFamily: 'Share Tech Mono',
      color: '#3d4f63',
      formatter: (p) => p.data.label || ''
    },
    data: [
      {
        name: 'core-rtr-01\nC8500-12X',
        symbolSize: 40,
        itemStyle: { color: '#00e5ff', borderColor: '#00e5ff', borderWidth: 2, shadowColor: '#00e5ff44', shadowBlur: 15 },
        label: { color: '#00e5ff', fontWeight: 700, fontSize: 10 },
        fixed: true, x: 150, y: 150
      },
      ...neighbors.map((n, i) => ({
        name: n.name,
        symbolSize: 26,
        itemStyle: {
          color: '#111820',
          borderColor: n.name.includes('fw') ? '#ff1744' : n.name.includes('edge') ? '#ffab00' : '#2979ff',
          borderWidth: 1.5
        }
      }))
    ],
    links: neighbors.map(n => ({
      source: 'core-rtr-01\nC8500-12X',
      target: n.name,
      label: n.port,
      lineStyle: { color: '#1e2a38', width: 1.5, curveness: 0.1 }
    })),
    emphasis: {
      focus: 'adjacency',
      lineStyle: { width: 3, color: '#00e5ff' }
    }
  }]
});

// ===== INTERFACE TABLE =====
const interfaces = [
  { name: 'TenGigE0/0/0', status: 'up', proto: 'up', ip: '10.1.1.1/30', speed: '10G', mtu: 9216, inMbps: 2847, outMbps: 1923, pctUtil: 28, errIn: 0, errOut: 0, desc: 'TO dist-sw-01 Te1/1' },
  { name: 'TenGigE0/0/1', status: 'up', proto: 'up', ip: '10.1.1.5/30', speed: '10G', mtu: 9216, inMbps: 2634, outMbps: 1847, pctUtil: 26, errIn: 0, errOut: 0, desc: 'TO dist-sw-02 Te1/1' },
  { name: 'TenGigE0/0/2', status: 'up', proto: 'up', ip: '10.1.2.1/30', speed: '10G', mtu: 9216, inMbps: 4102, outMbps: 3211, pctUtil: 41, errIn: 2, errOut: 0, desc: 'TO edge-rtr-01 Te0/1' },
  { name: 'TenGigE0/0/3', status: 'up', proto: 'up', ip: '10.1.2.5/30', speed: '10G', mtu: 9216, inMbps: 3987, outMbps: 3104, pctUtil: 39, errIn: 0, errOut: 0, desc: 'TO edge-rtr-02 Te0/1' },
  { name: 'TenGigE0/0/4', status: 'up', proto: 'up', ip: '10.1.3.1/30', speed: '10G', mtu: 9216, inMbps: 1245, outMbps: 987, pctUtil: 12, errIn: 0, errOut: 0, desc: 'TO fw-01 Eth1/1' },
  { name: 'TenGigE0/0/5', status: 'up', proto: 'up', ip: '10.1.4.1/30', speed: '10G', mtu: 9216, inMbps: 3456, outMbps: 2890, pctUtil: 34, errIn: 0, errOut: 1, desc: 'TO core-rtr-02 Te0/0/5 (iBGP)' },
  { name: 'TenGigE0/0/6', status: 'up', proto: 'up', ip: '—', speed: '10G', mtu: 9216, inMbps: 0, outMbps: 0, pctUtil: 0, errIn: 0, errOut: 0, desc: 'RESERVED - Future Peering' },
  { name: 'TenGigE0/0/7', status: 'up', proto: 'up', ip: '192.168.100.1/24', speed: '10G', mtu: 1500, inMbps: 12, outMbps: 8, pctUtil: 0, errIn: 0, errOut: 0, desc: 'Kentik Agent Tap' },
  { name: 'TenGigE0/0/8', status: 'down', proto: 'down', ip: '—', speed: '10G', mtu: 9216, inMbps: 0, outMbps: 0, pctUtil: 0, errIn: 0, errOut: 0, desc: 'DECOM - old transit link' },
  { name: 'TenGigE0/0/9', status: 'down', proto: 'down', ip: '—', speed: '10G', mtu: 9216, inMbps: 0, outMbps: 0, pctUtil: 0, errIn: 0, errOut: 0, desc: 'DECOM - old IX port' },
  { name: 'GigE0/0/0', status: 'up', proto: 'up', ip: '10.100.1.1/24', speed: '1G', mtu: 1500, inMbps: 2, outMbps: 1, pctUtil: 0, errIn: 0, errOut: 0, desc: 'MGMT - OOB' },
  { name: 'GigE0/0/1', status: 'admin-down', proto: 'down', ip: '—', speed: '1G', mtu: 1500, inMbps: 0, outMbps: 0, pctUtil: 0, errIn: 0, errOut: 0, desc: 'UNUSED - shutdown' },
  { name: 'Loopback0', status: 'up', proto: 'up', ip: '172.16.255.1/32', speed: '—', mtu: 65535, inMbps: 0, outMbps: 0, pctUtil: 0, errIn: 0, errOut: 0, desc: 'Router-ID / BGP Source' },
  { name: 'Loopback100', status: 'up', proto: 'up', ip: '172.16.254.1/32', speed: '—', mtu: 65535, inMbps: 0, outMbps: 0, pctUtil: 0, errIn: 0, errOut: 0, desc: 'Kentik Flow Export Source' },
  { name: 'Null0', status: 'up', proto: 'up', ip: '—', speed: '—', mtu: 65535, inMbps: 0, outMbps: 0, pctUtil: 0, errIn: 0, errOut: 0, desc: 'Blackhole' },
];

const itBody = document.querySelector('#intfTable tbody');
interfaces.forEach(i => {
  const stClass = i.status === 'up' ? 'intf-up' : i.status === 'admin-down' ? 'intf-admin-down' : 'intf-down';
  const utilClass = i.pctUtil > 70 ? 'util-high' : i.pctUtil > 40 ? 'util-med' : 'util-low';
  const errInColor = i.errIn > 0 ? 'color:var(--amber);font-weight:600' : 'color:var(--text-dim)';
  const errOutColor = i.errOut > 0 ? 'color:var(--amber);font-weight:600' : 'color:var(--text-dim)';

  itBody.innerHTML += `<tr>
    <td style="font-weight:600;color:var(--text-primary)">${i.name}</td>
    <td class="${stClass}">${i.status}</td>
    <td class="${stClass}">${i.proto}</td>
    <td>${i.ip}</td>
    <td>${i.speed}</td>
    <td>${i.mtu}</td>
    <td>${i.inMbps > 0 ? i.inMbps.toLocaleString() : '—'}</td>
    <td>${i.outMbps > 0 ? i.outMbps.toLocaleString() : '—'}</td>
    <td><div class="util-bar"><div class="util-bar-fill ${utilClass}" style="width:${i.pctUtil}%"></div></div> ${i.pctUtil}%</td>
    <td style="${errInColor}">${i.errIn}</td>
    <td style="${errOutColor}">${i.errOut}</td>
    <td style="color:var(--text-dim);font-size:10px">${i.desc}</td>
  </tr>`;
});

// ===== BGP TABLE =====
const bgpPeers = [
  { neighbor: '10.1.4.2', as: '394256', state: 'Established', updown: '347d', rcvd: 842100, sent: 12450, desc: 'core-rtr-02 (iBGP RR)' },
  { neighbor: '10.1.2.2', as: '7922', state: 'Established', updown: '291d', rcvd: 924000, sent: 450, desc: 'Comcast Transit' },
  { neighbor: '10.1.2.6', as: '3356', state: 'Established', updown: '214d', rcvd: 918000, sent: 450, desc: 'Lumen Transit' },
  { neighbor: '198.32.132.22', as: '32934', state: 'Established', updown: '189d', rcvd: 87, sent: 450, desc: 'Meta (IX peer)' },
  { neighbor: '198.32.132.45', as: '16509', state: 'Established', updown: '189d', rcvd: 6200, sent: 450, desc: 'Amazon (IX peer)' },
  { neighbor: '198.32.132.11', as: '15169', state: 'Established', updown: '189d', rcvd: 12800, sent: 450, desc: 'Google (IX peer)' },
  { neighbor: '198.32.132.67', as: '13335', state: 'Established', updown: '189d', rcvd: 3400, sent: 450, desc: 'Cloudflare (IX peer)' },
  { neighbor: '198.32.132.89', as: '8075', state: 'Established', updown: '145d', rcvd: 8900, sent: 450, desc: 'Microsoft (IX peer)' },
  { neighbor: '198.32.132.102', as: '20940', state: 'Established', updown: '189d', rcvd: 1200, sent: 450, desc: 'Akamai (IX peer)' },
  { neighbor: '198.32.132.133', as: '54113', state: 'Established', updown: '78d', rcvd: 420, sent: 450, desc: 'Fastly (IX peer)' },
  { neighbor: '10.1.5.2', as: '394256', state: 'Established', updown: '347d', rcvd: 842100, sent: 842100, desc: 'core-rtr-02 (iBGP full mesh)' },
  { neighbor: '10.1.6.2', as: '394256', state: 'Established', updown: '310d', rcvd: 842100, sent: 842100, desc: 'edge-rtr-01 (iBGP)' },
  { neighbor: '10.1.6.6', as: '394256', state: 'Established', updown: '310d', rcvd: 842100, sent: 842100, desc: 'edge-rtr-02 (iBGP)' },
  { neighbor: '198.32.132.200', as: '6939', state: 'Idle', updown: '2d', rcvd: 0, sent: 0, desc: 'Hurricane Electric (IX) - MAINTENANCE' },
  { neighbor: '198.32.132.210', as: '2914', state: 'Idle', updown: '14h', rcvd: 0, sent: 0, desc: 'NTT (IX) - investigating' },
  { neighbor: '10.1.7.2', as: '394256', state: 'Established', updown: '92d', rcvd: 842100, sent: 842100, desc: 'dist-sw-01 (iBGP)' },
];

const bgpBody = document.querySelector('#bgpTable tbody');
bgpPeers.forEach(p => {
  const stColor = p.state === 'Established' ? 'var(--green)' : 'var(--red)';
  const stBg = p.state === 'Established' ? '' : 'background:#ff174411;';
  bgpBody.innerHTML += `<tr style="${stBg}">
    <td style="font-weight:600">${p.neighbor}</td>
    <td>${p.as}</td>
    <td style="color:${stColor};font-weight:600">${p.state}</td>
    <td>${p.updown}</td>
    <td>${p.rcvd > 0 ? p.rcvd.toLocaleString() : '—'}</td>
    <td>${p.sent > 0 ? p.sent.toLocaleString() : '—'}</td>
    <td style="color:var(--text-dim);font-size:10px">${p.desc}</td>
  </tr>`;
});

// ===== INTERFACE ERRORS CHART =====
const errorChart = echarts.init(document.getElementById('errorChart'), null, { renderer: 'canvas' });
errorChart.setOption({
  tooltip: {
    trigger: 'axis',
    backgroundColor: '#151d27',
    borderColor: '#2a3a4e',
    textStyle: { color: '#c8d6e5', fontFamily: 'Share Tech Mono', fontSize: 11 }
  },
  grid: { left: 90, right: 20, top: 10, bottom: 30 },
  xAxis: {
    type: 'value',
    axisLine: { lineStyle: { color: '#1e2a38' } },
    axisLabel: { color: '#3d4f63', fontFamily: 'Share Tech Mono', fontSize: 10 },
    splitLine: { lineStyle: { color: '#111820' } }
  },
  yAxis: {
    type: 'category',
    data: ['Te0/0/0', 'Te0/0/1', 'Te0/0/2', 'Te0/0/3', 'Te0/0/4', 'Te0/0/5'],
    axisLine: { lineStyle: { color: '#1e2a38' } },
    axisLabel: { color: '#6b7d93', fontFamily: 'Share Tech Mono', fontSize: 10 }
  },
  series: [
    {
      name: 'CRC',
      type: 'bar',
      stack: 'errors',
      data: [0, 0, 2, 0, 0, 1],
      itemStyle: { color: '#ff1744' },
      barWidth: 12
    },
    {
      name: 'Input',
      type: 'bar',
      stack: 'errors',
      data: [0, 0, 0, 0, 0, 0],
      itemStyle: { color: '#ffab00' },
      barWidth: 12
    },
    {
      name: 'Drops',
      type: 'bar',
      stack: 'errors',
      data: [3, 1, 5, 2, 0, 4],
      itemStyle: { color: '#2979ff' },
      barWidth: 12
    }
  ]
});

// ===== RESIZE HANDLER =====
window.addEventListener('resize', () => {
  cpuChart.resize();
  memChart.resize();
  envChart.resize();
  throughputChart.resize();
  histChart.resize();
  neighborChart.resize();
  errorChart.resize();
});

// ===== SIMULATED LIVE UPDATES =====
setInterval(() => {
  const newCpu = clamp(DEVICE.cpu + (Math.random() - 0.5) * 6, 15, 60);
  DEVICE.cpu = Math.round(newCpu);
  cpuChart.setOption({ series: [{ data: [{ value: DEVICE.cpu, name: '5-MIN AVG' }] }] });

  const newMem = clamp(DEVICE.memPct + (Math.random() - 0.5) * 2, 65, 82);
  DEVICE.memPct = Math.round(newMem * 10) / 10;
  memChart.setOption({
    series: [{ data: [{ value: DEVICE.memPct, name: `${(DEVICE.memPct/100*16).toFixed(1)} / 16.0 GB` }] }]
  });
}, 3000);
</script>
</body>
</html>