# Cisco IOS-XE BGP summary template
# Parses: show ip bgp summary
# Produces: local AS, router-id, peer table

command: "show ip bgp summary"
interval: 60

patterns:
  identity:
    pattern: 'BGP router identifier\s+([\d.]+),\s+local AS number\s+(\d+)'
    groups:
      router_id: 1
      local_as: 2
    types:
      router_id: str
      local_as: int

  total_entries:
    pattern: 'BGP table version is\s+(\d+),\s+.*?(\d+)\s+network entries'
    groups:
      table_version: 1
      network_entries: 2
    types:
      table_version: int
      network_entries: int

  peers:
    type: table
    # Neighbor  V  AS  MsgRcvd MsgSent TblVer InQ OutQ Up/Down  State/PfxRcd
    pattern: '^([\d.]+)\s+4\s+(\d+)\s+(\d+)\s+(\d+)\s+\d+\s+\d+\s+\d+\s+(\S+)\s+(\S+)\s*$'
    flags: MULTILINE
    groups:
      neighbor: 1
      remote_as: 2
      msg_rcvd: 3
      msg_sent: 4
      updown: 5
      state_pfx: 6
    types:
      neighbor: str
      remote_as: int
      msg_rcvd: int
      msg_sent: int
      updown: str
      state_pfx: str
