# Cisco IOS-XE memory utilization template
# Parses: show processes memory sorted
# Produces: headline memory stats + per-process memory

command: "show processes memory sorted | head 30"
interval: 30

patterns:
  utilization:
    pattern: 'Processor Pool Total:\s+(\d+)\s+Used:\s+(\d+)\s+Free:\s+(\d+)'
    groups:
      total_bytes: 1
      used_bytes: 2
      free_bytes: 3
    types:
      total_bytes: int
      used_bytes: int
      free_bytes: int

  # Alternative pattern for different IOS-XE versions
  utilization_alt:
    pattern: 'Total:\s+(\d+),\s+Used:\s+(\d+),\s+Free:\s+(\d+)'
    groups:
      total_bytes: 1
      used_bytes: 2
      free_bytes: 3
    types:
      total_bytes: int
      used_bytes: int
      free_bytes: int

  processes:
    type: table
    pattern: '^\s*(\d+)\s+\S+\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(.+?)\s*$'
    flags: MULTILINE
    groups:
      pid: 1
      allocated: 2
      freed: 3
      holding: 4
      getbufs: 5
      name: 6
    types:
      pid: int
      allocated: int
      freed: int
      holding: int
      getbufs: int
      name: str
    sort_by: holding
    sort_desc: true
    limit: 15

# Post-processing: compute used_pct from total/used
post_process: compute_memory_pct
