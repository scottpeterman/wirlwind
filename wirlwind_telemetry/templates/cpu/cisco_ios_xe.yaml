# Cisco IOS-XE CPU utilization template
# Parses: show processes cpu sorted
# Produces: cpu headline stats + process table

command: "show processes cpu sorted | exclude 0.00%__0.00%__0.00%"
interval: 30

patterns:
  # Headline CPU utilization
  utilization:
    pattern: 'CPU utilization for five seconds:\s+(\d+)%/(\d+)%;\s+one minute:\s+(\d+)%;\s+five minutes:\s+(\d+)%'
    groups:
      five_sec_total: 1
      five_sec_interrupt: 2
      one_min: 3
      five_min: 4
    types:
      five_sec_total: int
      five_sec_interrupt: int
      one_min: int
      five_min: int

  # Per-process CPU table
  processes:
    type: table
    pattern: '^\s*(\d+)\s+(\d+)\s+(\d+)\s+(\d+(?:\.\d+)?)%\s+(\d+(?:\.\d+)?)%\s+(\d+(?:\.\d+)?)%\s+\d+\s+(.+?)\s*$'
    flags: MULTILINE
    groups:
      pid: 1
      runtime: 2
      invoked: 3
      five_sec: 4
      one_min: 5
      five_min: 6
      name: 7
    types:
      pid: int
      runtime: int
      invoked: int
      five_sec: float
      one_min: float
      five_min: float
      name: str
    sort_by: five_sec
    sort_desc: true
    limit: 20
