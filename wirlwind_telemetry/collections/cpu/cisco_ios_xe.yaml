# CPU collection - Cisco IOS / IOS-XE
# Works for both classic IOS (7200) and IOS-XE (CSR/ISR)
#
# Actual output format:
#   CPU utilization for five seconds: 4%/100%; one minute: 1%; five minutes: 1%
#    PID Runtime(ms)     Invoked      uSecs   5Sec   1Min   5Min TTY Process
#    209         312         166       1879  2.23%  0.22%  0.07%   3 SSH Process

command: "show processes cpu sorted | exclude 0.00%"
interval: 30

parsers:
  # Priority 1: ntc-templates TextFSM
  - type: textfsm
    templates:
      - cisco_ios_show_processes_cpu.textfsm

  # Priority 2: regex - captures summary line
  - type: regex
    pattern: 'CPU utilization for five seconds:\s+(\d+)%/(\d+)%;\s+one minute:\s+(\d+)%;\s+five minutes:\s+(\d+)%'
    flags: DOTALL
    groups:
      five_sec_total: 1
      five_sec_interrupts: 2
      one_min: 3
      five_min: 4

normalize:
  five_sec: five_sec_total
  one_min: one_min
  five_min: five_min
