# BGP Summary - Cisco IOS / IOS-XE
#
# Actual output:
#   Neighbor        V           AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd
#   172.16.1.1      4        65002    4521    4518       15    0    0 3d02h           5
#   10.0.0.1        4        65004       0       0        1    0    0 never    Idle
#
# NTC TextFSM returns (lowercased):
#   router_id, local_as, address_family, bgp_neighbor, bgp_version,
#   neighbor_as, messages_received, messages_sent, table_version,
#   input_queue, output_queue, up_down, state_or_prefixes_received
#
# NOTE: NTC uses "bgp_neighbor" (not "neighbor"), "neighbor_as" (not "remote_as"),
#       "up_down" (not "updown"), "state_or_prefixes_received" (not "state_pfx")

command: "show ip bgp summary"
interval: 60

parsers:
  # Priority 1: ntc-templates TextFSM
  - type: textfsm
    templates:
      - cisco_ios_show_ip_bgp_summary.textfsm

  # Priority 2: regex fallback
  # Group names aligned with TextFSM output for unified normalize map
  - type: regex
    pattern: '^([\d.]+)\s+4\s+(\d+)\s+\d+\s+\d+\s+\d+\s+\d+\s+\d+\s+(\S+)\s+(\S+)\s*$'
    flags: MULTILINE
    groups:
      bgp_neighbor: 1
      neighbor_as: 2
      up_down: 3
      state_or_prefixes_received: 4

# Map parser output â†’ canonical schema
normalize:
  neighbor: bgp_neighbor
  remote_as: neighbor_as
  uptime: up_down
  state_pfx: state_or_prefixes_received
