# BGP Summary collection - Arista EOS
#
# Actual output format:
#   BGP summary information for VRF default
#   Router identifier 172.16.255.1, local AS number 65001
#   Neighbor Status Codes: m - Under maintenance
#     Neighbor     V  AS           MsgRcvd   MsgSent  InQ OutQ  Up/Down State   PfxRcd PfxAcc
#     10.1.1.2     4  65002         524961    123456    0    0   291d    Estab   842100 842100
#     10.1.2.2     4  7922          412333     12456    0    0   145d    Estab   924000 924000
#     198.32.1.22  4  32934          98765      4567    0    0    89d    Idle
#
# TextFSM returns (lowercased):
#   bgp_neigh, neigh_as, msg_rcvd, msg_sent, in_queue, out_queue,
#   up_down, state_pfxrcd, pfx_acc
#
# Note: arista_eos_show_ip_bgp_summary.textfsm was added in ntc-templates v7.7.0.
# If your version doesn't have it, the regex fallback covers the common case.

command: "show ip bgp summary"
interval: 60

parsers:
  # Priority 1: ntc-templates TextFSM
  - type: textfsm
    templates:
      - arista_eos_show_ip_bgp_summary.textfsm

  # Priority 2: regex - captures neighbor lines
  - type: regex
    pattern: '^\s*([\d.]+)\s+4\s+(\d+)\s+(\d+)\s+(\d+)\s+\d+\s+\d+\s+(\S+)\s+(\S+)'
    flags: MULTILINE
    groups:
      neighbor: 1
      remote_as: 2
      msg_rcvd: 3
      msg_sent: 4
      up_down: 5
      state_pfx: 6

normalize:
  neighbor: bgp_neigh
  remote_as: neigh_as
  msg_rcvd: msg_rcvd
  msg_sent: msg_sent
  up_down: up_down
  state_pfx: state_pfxrcd
