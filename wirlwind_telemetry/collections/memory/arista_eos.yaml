# CPU collection - Arista EOS
#
# TextFSM (custom override) returns:
#   global_cpu_percent_user, global_cpu_percent_system, global_cpu_percent_idle
#   pid, user, priority, nice, percent_cpu, percent_memory, command, etc.
#
# Regex fallback returns:
#   user_pct, system_pct, idle_pct

command: "show processes top once"
interval: 30

parsers:
  - type: textfsm
    templates:
      - arista_eos_show_processes_top_once.textfsm

  - type: regex
    pattern: '%Cpu\(s\):\s*(\S+)\s+us,\s*(\S+)\s+sy,\s*\S+\s+ni,\s*(\S+)\s+id'
    flags: DOTALL
    groups:
      user_pct: 1
      system_pct: 2
      idle_pct: 3

normalize:
  # TextFSM global fields â†’ canonical
  idle_pct: global_cpu_percent_idle
  user_pct: global_cpu_percent_user
  system_pct: global_cpu_percent_system
  # Per-process fields (TextFSM)
  cpu_pct: percent_cpu
  mem_pct: percent_memory
  name: command